var Xrm;!function(a){var b;!function(a){!function(a){a[a.And=0]="And",a[a.Or=1]="Or"}(a.FilterTypes||(a.FilterTypes={}));a.FilterTypes}(b=a.oData||(a.oData={}))}(Xrm||(Xrm={}));var Xrm;!function(a){var b;!function(b){var c=function(){function b(b){this.filterType=a.oData.FilterTypes.And,this.filterExpressions=[],this.filters=[];for(var c in this)this.hasOwnProperty(c)&&(this[c]=b[c])}return b.prototype.toString=function(){var b="",c="";switch(this.filterType){case a.oData.FilterTypes.And:c="and";break;case a.oData.FilterTypes.Or:c="or"}for(var d=0;d<this.filterExpressions.length;d++){var e=this.filterExpressions[d];d>0&&(b+=" "+c+" "),"("!==e[0]&&(b+="("),b+=e,")"!==e[e.length-1]&&(b+=")")}if(""!=b&&this.filters&&this.filters.length>0){b+=" "+c+" ";for(var d=0;d<this.filters.length;d++){var f=this.filters[d];d>0&&(b+=" "+c+" ");var g=f.filterExpressions&&f.filterExpressions.length>1,h=f.filters&&f.filters.length>0;b+=g||h?"("+f.toString()+")":f.toString()}}return b},b}();b.FilterInfo=c}(b=a.oData||(a.oData={}))}(Xrm||(Xrm={}));var Xrm;!function(a){var b;!function(a){!function(a){a[a.Asc=0]="Asc",a[a.Desc=1]="Desc"}(a.OrderTypes||(a.OrderTypes={}));a.OrderTypes}(b=a.oData||(a.oData={}))}(Xrm||(Xrm={}));var Xrm;!function(a){var b;!function(b){var c=function(){function b(b){this.column="",this.order=a.oData.OrderTypes.Asc;for(var c in this)this.hasOwnProperty(c)&&(this[c]=b[c])}return b}();b.OrderColumn=c}(b=a.oData||(a.oData={}))}(Xrm||(Xrm={}));var Xrm;!function(a){var b;!function(b){var c=function(){function b(a){this._url=a,this._entityName="",this._columns=[],this._expand=[],this._orders=[],this._skip=0,this._top=0}return b.prototype.setEntity=function(a){return this._entityName=a,this},b.prototype.setColumns=function(a){return a.length>0&&(this._columns=a.split(",")),this},b.prototype.setExpand=function(a){return a.length>0&&(this._expand=a.split(",")),this},b.prototype.setFilters=function(a){return this._filters=a,this},b.prototype.setOrders=function(a){return this._orders=a.slice(0,12),this},b.prototype.setSkip=function(a){return this._skip=a,this},b.prototype.setTop=function(a){return this._top=a,this},b.prototype.toString=function(){var a=this.getQueryUrlPart(),b=this.getQueryFiltersPart(),c=a+(""!==b?"?"+b:b);return c},b.prototype.getQueryUrlPart=function(){if(!this._url||!this._entityName)throw new Error("Не задан URL или имя сущности.");var a=this._url;return a=a.concat("/"==a[a.length-1]?"":"/",this._entityName)},b.prototype.getQueryFiltersPart=function(){var b="";if(this._columns&&this._columns.length>0&&(b=this.concatRequestPart(b,"$select="+this._columns.join(","))),this._expand&&this._expand.length>0&&(b=this.concatRequestPart(b,"$expand="+this._expand.join(","))),this._filters&&(b=this.concatRequestPart(b,"$filter="+this._filters.toString())),this._orders&&this._orders.length>0){b=this.concatRequestPart(b,"$orderby=");for(var c=0;c<this._orders.length;c++){var d=this._orders[c];b+=d.column,d.order==a.oData.OrderTypes.Desc&&(b+=" desc"),c<this._orders.length-1&&(b+=",")}}return this._skip&&this._skip>0&&(b=this.concatRequestPart(b,"$skip="+this._skip)),this._top&&this._top>0&&(b=this.concatRequestPart(b,"$top="+this._top)),b},b.prototype.sendQuery=function(a,b){var c=new XMLHttpRequest;c.open("GET",this.toString(),!0),c.setRequestHeader("Accept","application/json"),c.onreadystatechange=function(){var c=this;if(4==c.readyState)if(c.onreadystatechange=null,200==c.status){if(a){var d=JSON.parse(c.responseText);d=d.d||d,a(d)}}else b&&b(c)},c.send()},b.prototype.concatRequestPart=function(a,b){return a=a||"",b&&(a.length>0&&(a=a.concat("&")),a=a.concat(b)),a},b}();b.QueryBuilder=c}(b=a.oData||(a.oData={}))}(Xrm||(Xrm={}));